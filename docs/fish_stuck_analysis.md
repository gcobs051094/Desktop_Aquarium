# 魚卡在原地（面朝右卻不動）原因分析

## 問題現象
魚面部朝右，但不會往右（或往下）游，看起來卡在原地。

## 根本原因

### 原因一：轉向期間 target_direction 被隨機改掉（主要）

**流程：**
1. 魚從「朝左」要轉成「朝右」，進入 `state = "turning"`，播放轉向動畫。
2. 轉向動畫會播很多幀（例如約 45 幀，每幀 `turn_progress += 0.2`，要達到 `len(turn_frames)` 才結束）。
3. 在**轉向期間**，`update()` 每一幀仍會執行：
   ```python
   self.turn_timer += 1
   if self.turn_timer >= self.turn_interval:
       self.target_direction = random.uniform(0, 360)  # 被改掉！
   ```
4. 因此轉向還沒播完，`target_direction` 就被改成隨機角度（例如 200°）。
5. `direction` 會朝這個新目標平滑旋轉，所以可能又轉回「朝左」範圍（90°～270°）。
6. 轉向動畫結束時：
   - 程式設 `facing_left = False`（以為已經朝右），
   - 但此時 `direction` 可能已是 180°、200° 等（朝左）。
7. 結果：**顯示上面朝右（鏡像），但位移用 direction 算出來是往左** → 看起來像往左動或幾乎不動。
8. 下一幀 `new_facing_left = True`（因為 direction 在 90°～270°），又立刻進入「轉向到左」，形成**反覆轉向**，魚就卡在原地或亂抖。

**結論：** 轉向時不應讓「隨機下次轉向」去改 `target_direction`，否則轉向目標會被破壞，導致面朝右但 direction 朝左，並不斷重新觸發轉向。

### 原因二：轉向結束時 direction 被設成 90° 或 270°

當「轉向到右」結束時，若當時 `direction` 剛好是 **90°** 或 **270°**（邊界值），程式會做：

- `direction == 90` → 設成 `270`（往上看）
- `direction == 270` → 設成 `90`（往下看）

於是魚會變成**純上下移動**，而不是往右。而且 270° 仍落在 `_is_facing_left` 的 90°～270° 區間，下一幀又會判定要「轉向到左」，容易造成反覆轉向，看起來像卡住。

## 修正方式

1. **轉向期間不要更新 target_direction**  
   只有 `state == "swim"` 時才執行「隨機下次轉向」、改 `target_direction`，轉向中保持原本的目標方向。

2. **轉向結束、要朝右時，若 direction 為 90 或 270**  
   不要設成 270 或 90，改設成 **0°（往右）**，避免純上下移動並減少立刻再觸發轉向的狀況。

實施以上兩點後，魚在「面朝右」時會穩定往右（或斜右）游，不再卡在原地。
