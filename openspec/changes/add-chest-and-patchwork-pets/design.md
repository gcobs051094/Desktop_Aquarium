# Design: 寶箱怪與拼布魚寵物

## Context
- 現有寵物僅龍蝦，解鎖條件為魚種數量（unlock_species + unlock_count）。
- 寶箱怪需「金幣解鎖」且具定點、計時產物與開啟動畫；拼布魚需金幣解鎖且具吃飼料、飽足度與全場 buff，兩者行為與龍蝦差異大，需新寵物類別與解鎖流程。

## Goals / Non-Goals
- **Goals**：實作金幣解鎖、寶箱怪定時產物與開啟動畫、拼布魚吃飼料與快樂 buff（大便間隔 −5%）。
- **Non-Goals**：本變更不實作「寵物升級系統」；寶箱怪產物種類仍為珍珠/金條/鑽石三選一，升級後不同產物留待後續變更。

## Decisions

### 1. 金幣解鎖語意
- `PET_CONFIG` 新增可選 `unlock_money: int`。若存在則解鎖條件為「金幣解鎖」：商店顯示「需 2000 金幣解鎖」等；玩家點擊購買時若 `total_money >= unlock_money` 則扣款 `unlock_money` 並標記該寵物已解鎖，之後可免費召喚。
- 若同時存在 `unlock_species` 與 `unlock_money`，約定以 `unlock_money` 優先（或僅擇一使用），避免雙重條件造成混淆；本變更中寶箱怪與拼布魚僅使用 `unlock_money`。

### 2. 寶箱怪動畫與產物時機
- 使用 `resource/pet/寶箱怪/1_開啟/` 共 10 幀（000–009）。預設顯示第 0 幀（關閉）。
- 產物週期 180 秒（3 分鐘）。在週期結束前約 N 秒（例如 10 秒）開始播放開啟動畫（0→1→…→9），第 7 幀（索引 6 或 7，依素材）時在寶箱嘴部位置生成一顆隨機產物（珍珠/金條/鑽石）為可拾取金錢物件，產物價值依 `MONEY_VALUE`。
- 產物素材：若 `resource/money/珍珠`、`resource/money/金條`、`resource/money/鑽石` 存在則用之；否則可暫用 `resource/money/寶箱怪產物/` 內單張圖或對應檔名（珍珠/金塊→金條/鑽石）作為單幀金錢物件。

### 3. 拼布魚實作方式
- 拼布魚使用 `resource/pet/拼布魚/` 下與魚類相同結構（5_吃飽游泳、6_吃飽吃、7_吃飽轉向），故可實作為「具魚類動畫與吃飼料邏輯的寵物」：在 `pet.py` 中新增類別，擁有位置、移動、朝向、吃飼料偵測、飽足度 0–30、動畫狀態機；移動速度由 `PET_CONFIG` 設定為較一般魚高。
- 飽足度滿（30）時觸發一次「快樂」：設定全場快樂 buff 剩餘時間 30 秒（1800 幀 @ 60fps），並可將拼布魚飽足度歸零或進入冷卻，避免連續觸發。

### 4. 快樂 buff 對大便間隔的影響
- 在水族箱或視窗層維護 `happy_buff_remaining_sec`（或幀數）。魚類在 `update` 中計算「有效大便間隔」時：若 `happy_buff_remaining_sec > 0` 則使用 `poop_interval_sec * 0.95`，否則使用 `poop_interval_sec`。僅影響「間隔長度」，不改變產物種類。

## Risks / Trade-offs
- 金幣解鎖與魚種解鎖並存時，UI 需清楚標示當前寵物為「金幣解鎖」或「魚種解鎖」，避免誤解。
- 寶箱怪產物若使用單張圖而非動畫幀，與現有金錢物件多幀動畫不一致，可接受為首版；後續可補齊珍珠/金條/鑽石之多幀素材。

## Migration Plan
- 無既有存檔遷移；新欄位 `unlock_money`、新寵物 `寶箱怪` / `拼布魚` 僅對新行為生效。存檔中需持久化「已解鎖寵物」集合（含金幣解鎖之寵物）與快樂 buff 不強制存檔（重開後歸零即可）。

## Open Questions
- 拼布魚飽足度滿後是否立即歸零或緩慢遞減，以利再次觸發快樂？（建議：觸發後歸零或設冷卻，避免 30 秒內重複觸發。）
