# Change: 重構魚類移動行為系統

## Why
目前的魚類移動邏輯存在以下問題：
1. 頭部朝向與移動方向的對應邏輯過於複雜，難以維護
2. 角度轉換邏輯有多處修正程式碼，表示設計不夠清晰
3. 素材朝向（頭朝左）與移動方向的關係沒有明確定義
4. **位置精度問題**：使用 `QPoint(int(x), int(y))` 儲存位置，導致每幀小數位移被截斷，魚無法累積移動（例如 642.67 → 642，永遠無法到達 643）

需要重新設計一個更清晰、更直觀的移動系統，確保魚的頭部方向始終與游動方向一致，並修正位置精度問題。

## What Changes
- **重新定義移動方向系統**：簡化角度系統，使移動方向與頭部朝向關係更直觀
- **明確素材使用規則**：
  - 游泳素材（頭朝左）：向左移動時直接使用，向右移動時水平鏡像
  - 轉向素材（左轉右）：左轉右時直接使用，右轉左時水平鏡像
- **支援 8 方向移動**：左、右、上、下、左上、左下、右上、右下
- **移除過度複雜的角度修正邏輯**
- **修正位置精度**：使用 `QPointF` 儲存位置（浮點數），避免小數位移被截斷
- **邊界處理優化**：增加無效矩形檢查，避免 widget 尚未佈局時誤判邊界

## Impact
- Affected specs: fish-behavior（新建）
- Affected code: `fish.py`, `aquarium_window.py`

## Bug Fixes
在實作過程中發現並修正了以下問題：
1. **位置精度問題**：`QPoint` 使用整數座標，導致小數位移（如 0.67 像素/幀）無法累積，魚看起來卡住不動
   - **修正**：改用 `QPointF` 儲存位置，繪製時再轉換為整數
2. **邊界處理時機問題**：當 widget 尚未完成佈局時，`rect()` 可能無效，導致邊界判斷錯誤
   - **修正**：增加矩形有效性檢查，無效時跳過邊界處理；`aquarium_window.py` 增加備援邏輯
3. **方向變更邏輯問題**：`_change_horizontal_direction` 在某些情況下不會正確更新 `facing_left`
   - **修正**：簡化邏輯，確保方向與朝向一致性
